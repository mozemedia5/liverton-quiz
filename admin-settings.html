<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Settings - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-text { background: linear-gradient(45deg, #0891b2, #0e7490); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-slate-900/80 backdrop-blur-md z-50 border-b border-cyan-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">AD</span>
                    </div>
                    <span class="text-xl font-semibold">Admin Dashboard</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="admin-dashboard.html" class="text-white hover:text-cyan-300 transition-colors">Dashboard</a>
                    <a href="admin-questions.html" class="text-white hover:text-cyan-300 transition-colors">Questions</a>
                    <a href="admin-users.html" class="text-white hover:text-cyan-300 transition-colors">Users</a>
                    <a href="admin-payments.html" class="text-white hover:text-cyan-300 transition-colors">Payments</a>
                    <a href="admin-settings.html" class="text-cyan-400 hover:text-cyan-300 transition-colors">Settings</a>
                    <button id="logoutBtn" class="text-white hover:text-red-300 transition-colors">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="pt-20 pb-8">
        <div class="max-w-4xl mx-auto px-4">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold gradient-text mb-2">Competition Settings</h1>
                <p class="text-gray-300">Update competition details displayed on the homepage</p>
            </div>

            <!-- Success/Error Messages -->
            <div id="messageBox" class="hidden mb-6 p-4 rounded-lg"></div>

            <!-- Settings Form -->
            <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-8 border border-cyan-500/20">
                <form id="settingsForm" class="space-y-6">
                    
                    <!-- Competition Duration Section -->
                    <div class="border-b border-slate-700 pb-6">
                        <h2 class="text-2xl font-semibold mb-4 text-cyan-400">Competition Duration</h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Duration Text</label>
                                <input type="text" id="durationText" placeholder="e.g., 4 Weeks" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date Range</label>
                                <input type="text" id="dateRange" placeholder="e.g., Jan 26 - Feb 20, 2026" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                        </div>
                    </div>

                    <!-- Prizes Section -->
                    <div class="border-b border-slate-700 pb-6">
                        <h2 class="text-2xl font-semibold mb-4 text-cyan-400">Prize Money</h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Winner Prize</label>
                                <input type="text" id="winnerPrize" placeholder="e.g., 500,000 UGX" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Runner-up Prize</label>
                                <input type="text" id="runnerupPrize" placeholder="e.g., 100,000 UGX" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                        </div>
                    </div>

                    <!-- Entry Fee Section -->
                    <div class="border-b border-slate-700 pb-6">
                        <h2 class="text-2xl font-semibold mb-4 text-cyan-400">Entry Fee</h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Entry Fee Amount</label>
                                <input type="text" id="entryFee" placeholder="e.g., 2,000 UGX" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Entry Fee Description</label>
                                <input type="text" id="entryFeeDesc" placeholder="e.g., Affordable for all" required 
                                       class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none transition-all">
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="bg-slate-700/30 rounded-xl p-6">
                        <h3 class="text-xl font-semibold mb-4 text-yellow-400">Live Preview</h3>
                        <p class="text-sm text-gray-400 mb-4">This is how it will appear on the homepage:</p>
                        
                        <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-cyan-500/20">
                            <div class="grid md:grid-cols-3 gap-6 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-cyan-400" id="previewDuration">4 Weeks</div>
                                    <div class="text-gray-300 text-sm">Competition Duration</div>
                                    <div class="text-xs text-gray-400" id="previewDateRange">Jan 26 - Feb 20, 2026</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-green-400" id="previewWinner">500,000 UGX</div>
                                    <div class="text-gray-300 text-sm">Winner Prize</div>
                                    <div class="text-xs text-gray-400">+ Runner-up: <span id="previewRunnerup">100,000 UGX</span></div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-yellow-400" id="previewEntryFee">2,000 UGX</div>
                                    <div class="text-gray-300 text-sm">Entry Fee</div>
                                    <div class="text-xs text-gray-400" id="previewEntryDesc">Affordable for all</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-4">
                        <button type="submit" id="saveBtn" 
                                class="flex-1 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white py-3 px-6 rounded-lg font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="saveBtnText">Save Changes</span>
                            <span id="saveBtnLoading" class="hidden">Saving...</span>
                        </button>
                        
                        <button type="button" id="resetBtn" 
                                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all">
                            Reset Form
                        </button>
                    </div>

                </form>
            </div>

            <!-- Back to Dashboard -->
            <div class="mt-6 text-center">
                <a href="admin-dashboard.html" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                    ‚Üê Back to Dashboard
                </a>
            </div>
        </div>
    </section>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAvqWrEUrag34Wb92D1ixmXVCh3-HY5iB8",
            authDomain: "liverton-quiz-championship.firebaseapp.com",
            projectId: "liverton-quiz-championship",
            storageBucket: "liverton-quiz-championship.firebasestorage.app",
            messagingSenderId: "1090719692182",
            appId: "1:1090719692182:web:96920d6ba665541a6a59b7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check authentication and admin role
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'admin-login.html';
                return;
            }

            // Verify admin role
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (!userDoc.exists() || userDoc.data().role !== 'admin') {
                alert('Access denied. Admin privileges required.');
                await signOut(auth);
                window.location.href = 'admin-login.html';
                return;
            }

            // Load current settings
            await loadSettings();
        });

        // Load settings from Firestore
        async function loadSettings() {
            try {
                const settingsDoc = await getDoc(doc(db, 'settings', 'competition'));
                
                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('durationText').value = data.durationText || '';
                    document.getElementById('dateRange').value = data.dateRange || '';
                    document.getElementById('winnerPrize').value = data.winnerPrize || '';
                    document.getElementById('runnerupPrize').value = data.runnerupPrize || '';
                    document.getElementById('entryFee').value = data.entryFee || '';
                    document.getElementById('entryFeeDesc').value = data.entryFeeDesc || '';
                    
                    updatePreview();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showMessage('Error loading settings. Please try again.', 'error');
            }
        }

        // Update live preview
        function updatePreview() {
            document.getElementById('previewDuration').textContent = document.getElementById('durationText').value || '4 Weeks';
            document.getElementById('previewDateRange').textContent = document.getElementById('dateRange').value || 'Jan 26 - Feb 20, 2026';
            document.getElementById('previewWinner').textContent = document.getElementById('winnerPrize').value || '500,000 UGX';
            document.getElementById('previewRunnerup').textContent = document.getElementById('runnerupPrize').value || '100,000 UGX';
            document.getElementById('previewEntryFee').textContent = document.getElementById('entryFee').value || '2,000 UGX';
            document.getElementById('previewEntryDesc').textContent = document.getElementById('entryFeeDesc').value || 'Affordable for all';
        }

        // Add input event listeners for live preview
        const inputs = ['durationText', 'dateRange', 'winnerPrize', 'runnerupPrize', 'entryFee', 'entryFeeDesc'];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });

        // Save settings
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');
            const saveBtnLoading = document.getElementById('saveBtnLoading');

            saveBtn.disabled = true;
            saveBtnText.classList.add('hidden');
            saveBtnLoading.classList.remove('hidden');

            try {
                const settings = {
                    durationText: document.getElementById('durationText').value,
                    dateRange: document.getElementById('dateRange').value,
                    winnerPrize: document.getElementById('winnerPrize').value,
                    runnerupPrize: document.getElementById('runnerupPrize').value,
                    entryFee: document.getElementById('entryFee').value,
                    entryFeeDesc: document.getElementById('entryFeeDesc').value,
                    updatedAt: serverTimestamp(),
                    updatedBy: auth.currentUser.uid
                };

                await setDoc(doc(db, 'settings', 'competition'), settings);
                showMessage('Settings saved successfully! Changes will appear on the homepage.', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showMessage('Error saving settings: ' + error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtnText.classList.remove('hidden');
                saveBtnLoading.classList.add('hidden');
            }
        });

        // Reset form
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the form? Unsaved changes will be lost.')) {
                loadSettings();
            }
        });

        // Show message
        function showMessage(message, type) {
            const messageBox = document.getElementById('messageBox');
            messageBox.className = type === 'success' 
                ? 'mb-6 p-4 rounded-lg bg-green-500/20 border border-green-500/50 text-green-200'
                : 'mb-6 p-4 rounded-lg bg-red-500/20 border border-red-500/50 text-red-200';
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await signOut(auth);
            window.location.href = 'admin-login.html';
        });
    </script>
</body>
</html>
