<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Liverton Quiz Championship</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-text { background: linear-gradient(45deg, #0891b2, #0e7490); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .quiz-active { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-slate-900/80 backdrop-blur-md z-50 border-b border-cyan-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">LQ</span>
                    </div>
                    <span class="text-xl font-semibold">Liverton Quiz</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="dashboard.html" class="text-cyan-400 hover:text-cyan-300 transition-colors">Dashboard</a>
                    <a href="quiz.html" class="text-white hover:text-cyan-300 transition-colors">Daily Quiz</a>
                    <a href="leaderboard.html" class="text-white hover:text-cyan-300 transition-colors">Leaderboard</a>
                    <a href="rules.html" class="text-white hover:text-cyan-300 transition-colors">Rules</a>
                    <button id="logoutBtn" class="text-white hover:text-red-300 transition-colors">Logout</button>
                </div>
            </div>
        </div>
    </nav>
<!-- =====  MOBILE MENU  ===== -->
<div id="mobileMenu" class="hidden fixed inset-0 bg-slate-900/95 backdrop-blur-lg z-40">
  <div class="flex flex-col items-center justify-center h-full space-y-8 text-xl">
    <a href="dashboard.html"       class="text-cyan-400 hover:text-cyan-300" onclick="hideMobileMenu()">Dashboard</a>
    <a href="quiz.html"            class="text-white hover:text-cyan-300"   onclick="hideMobileMenu()">Daily Quiz</a>
    <a href="leaderboard.html"     class="text-white hover:text-cyan-300"   onclick="hideMobileMenu()">Leaderboard</a>
    <a href="rules.html"           class="text-white hover:text-cyan-300"   onclick="hideMobileMenu()">Rules</a>
    <button onclick="hideMobileMenu(); signOut(auth).then(() => window.location.href='index.html')" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg text-white">Logout</button>
  </div>
  <button onclick="hideMobileMenu()" class="absolute top-6 right-6 text-white">
    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
  </button>
</div>

    <!-- Main Content -->
    <section class="pt-20 pb-8">
        <div class="max-w-7xl mx-auto px-4">
            <!-- Welcome Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold gradient-text mb-2">Welcome, <span id="userName">User</span>!</h1>
                <p class="text-gray-300">Ready for today's quiz challenge?</p>
            </div>

            <!-- Stats Grid -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-cyan-500/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Total Points</p>
                            <p class="text-2xl font-bold text-cyan-400" id="totalPoints">0</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-green-500/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Quizzes Taken</p>
                            <p class="text-2xl font-bold text-green-400" id="quizzesTaken">0</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-yellow-500/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Average Score</p>
                            <p class="text-2xl font-bold text-yellow-400" id="averageScore">0%</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Rank</p>
                            <p class="text-2xl font-bold text-purple-400" id="userRank">-</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Today's Quiz Status -->
            <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-8 border border-cyan-500/20 mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2">Today's Quiz</h2>
                        <p class="text-gray-300 mb-4" id="quizDate"></p>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-400 rounded-full" id="quizStatusIndicator"></div>
                                <span class="text-gray-300" id="quizStatus">Available</span>
                            </div>
                            <div class="text-sm text-gray-400" id="quizTimeLeft"></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <button id="startQuizBtn" class="bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white px-8 py-3 rounded-xl font-semibold transition-all transform hover:scale-105">
                            Start Quiz
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-cyan-500/20">
                    <h3 class="text-xl font-bold mb-6">Recent Quizzes</h3>
                    <div id="recentQuizzes" class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-slate-700/50 rounded-lg">
                            <div>
                                <p class="font-medium">No quizzes taken yet</p>
                                <p class="text-sm text-gray-400">Take your first quiz to see your progress</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/60 backdrop-blur-sm rounded-2xl p-6 border border-cyan-500/20">
                    <h3 class="text-xl font-bold mb-6">Achievements</h3>
                    <div id="achievements" class="space-y-4">
                        <div class="flex items-center space-x-4 p-4 bg-slate-700/50 rounded-lg">
                            <div class="w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium">First Steps</p>
                                <p class="text-sm text-gray-400">Complete your first quiz</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-900 py-8 border-t border-slate-700">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p class="text-gray-400 mb-2">© 2026 Liverton Quiz Championship | © Liverton Codes</p>
            <p class="text-gray-500 text-sm">Designed by Musa</p>
        </div>
    </footer>
<script type="module">
/*  =====  Firebase boiler-plate  =====  */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, query, where, getDocs, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAvqWrEUrag34Wb92D1ixmXVCh3-HY5iB8",
  authDomain: "liverton-quiz-championship.firebaseapp.com",
  projectId: "liverton-quiz-championship",
  storageBucket: "liverton-quiz-championship.firebasestorage.app",
  messagingSenderId: "1090719692182",
  appId: "1:1090719692182:web:96920d6ba665541a6a59b7"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db  = getFirestore(app);

/*  =====  entry point  =====  */
onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = 'login.html'; return; }
  await loadUserData(user.uid);
  updateQuizStatus();
});

/*  =====  load everything  =====  */
async function loadUserData(userId) {
  // ---- user name ----
  const userDoc = await getDoc(doc(db, 'users', userId));
  document.getElementById('userName').textContent = userDoc.data()?.name || 'User';

  // ---- season-independent stats ----
  const attemptsSnap = await getDocs(query(collection(db, 'attempts'), where('userId', '==', userId)));
  let totalP = 0, taken = 0;
  attemptsSnap.forEach(d => {
    const a = d.data();
    if (a.completed) { totalP += a.score; taken += 1; }
  });
  const avg = taken ? Math.round((totalP / (taken * 30)) * 100) : 0;
  document.getElementById('totalPoints').textContent  = totalP;
  document.getElementById('quizzesTaken').textContent = taken;
  document.getElementById('averageScore').textContent = avg + '%';

  // ---- rank (global leaderboard) ----
  await updateUserRank(userId);

  // ---- recent quizzes + achievement text swap ----
  await loadRecentQuizzes(userId, taken);
}

/*  ----------  rank  ----------  */
async function updateUserRank(userId) {
  try {
    const allSnap = await getDocs(query(collection(db, 'attempts'), where('completed', '==', true)));
    const board = {};
    allSnap.forEach(d => { const a = d.data(); board[a.userId] = (board[a.userId] || 0) + a.score; });
    const sorted = Object.entries(board).sort((a, b) => b[1] - a[1]);
    const myRank = sorted.findIndex(e => e[0] === userId) + 1;
    document.getElementById('userRank').textContent = myRank ? `#${myRank}` : '-';
  } catch (e) {
    console.error('rank error', e);
    document.getElementById('userRank').textContent = '-';
  }
}

/*  ----------  recent quizzes  ----------  */
async function loadRecentQuizzes(userId, taken) {
  const q   = query(collection(db, 'attempts'), where('userId', '==', userId), orderBy('finishedAt', 'desc'), limit(5));
  const snap = await getDocs(q);
  const box  = document.getElementById('recentQuizzes');

  /*  fill rows or keep default message  */
  if (!snap.empty) {
    box.innerHTML = '';                       // clear default
    snap.forEach(d => {
      const a = d.data();
      const date = new Date(a.finishedAt).toLocaleDateString('en-US');
      const pc   = Math.round((a.score / 30) * 100);
      const row  = document.createElement('div');
      row.className = 'flex items-center justify-between p-4 bg-slate-700/50 rounded-lg';
      row.innerHTML = `
        <div>
          <p class="font-medium">Quiz – ${date}</p>
          <p class="text-sm text-gray-400">Score: ${a.score}/30 (${pc}%)</p>
        </div>
        <div class="text-right">
          <p class="text-sm text-gray-400">Time: ${a.totalTime}s</p>
        </div>`;
      box.appendChild(row);
    });
  }

  /*  achievement box text swap  */
  const msgEl = document.querySelector('#achievements p.text-sm.text-gray-400');
  if (msgEl && taken > 0) msgEl.textContent = 'Proceed on your journey';
}

/*  ----------  weekday / time gate (unchanged)  ----------  */
function updateQuizStatus() {
  const today     = new Date();
  const dayOfWeek = today.getDay();          // 0 = Sunday
  const hour      = today.getHours();
  const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5;
  const inTime    = hour >= 9 && hour < 20;

  document.getElementById('quizDate').textContent = today.toLocaleDateString('en-US', {
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
  });

  const indicator = document.getElementById('quizStatusIndicator');
  const statusTxt = document.getElementById('quizStatus');
  const timeTxt   = document.getElementById('quizTimeLeft');
  const btn       = document.getElementById('startQuizBtn');

  if (!isWeekday) {
    indicator.className = 'w-3 h-3 bg-gray-400 rounded-full';
    statusTxt.textContent = 'Not Available (Weekend)';
    timeTxt.textContent   = 'Quizzes available Monday-Friday only';
    btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
  } else if (!inTime) {
    indicator.className = 'w-3 h-3 bg-gray-400 rounded-full';
    statusTxt.textContent = 'Not Available';
    btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
    timeTxt.textContent = hour < 9 ? 'Quiz opens at 9:00 AM' : 'Quiz closed for today';
  } else {
    indicator.className = 'w-3 h-3 bg-green-400 rounded-full quiz-active';
    statusTxt.textContent = 'Available';
    btn.disabled = false;
    const minLeft = Math.floor((new Date(today).setHours(20, 0, 0, 0) - today) / 60000);
    timeTxt.textContent = `${minLeft} minutes remaining`;
  }
}

/*  ----------  buttons  ----------  */
document.getElementById('startQuizBtn').addEventListener('click', () => window.location.href = 'quiz.html');
document.getElementById('logoutBtn').addEventListener('click', async () => {
  await signOut(auth);
  window.location.href = 'index.html';
});

/*  ----------  minute refresh  ----------  */
setInterval(updateQuizStatus, 60000);
/*  =====  MOBILE MENU  =====  */
window.toggleMobileMenu = function () {
  const menu = document.getElementById('mobileMenu');
  menu.classList.toggle('hidden');
};
window.hideMobileMenu = function () {
  document.getElementById('mobileMenu').classList.add('hidden');
};

</script>

 
</body>
</html>